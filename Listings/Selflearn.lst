C51 COMPILER V9.54   SELFLEARN                                                             06/16/2016 11:58:37 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE SELFLEARN
OBJECT MODULE PLACED IN .\Objects\Selflearn.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE Selflearn.c ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DE
                    -BUG OBJECTEXTEND PRINT(.\Listings\Selflearn.lst) TABS(3) OBJECT(.\Objects\Selflearn.obj)

line level    source

   1          /*------------------------------------------------------------------*-
   2             A.C (v1.00)
   3            ------------------------------------------------------------------
   4             Simple switch interface code, with software debounce.
   5          
   6             COPYRIGHT
   7             ---------
   8             This code is copyright (c) 2001 by Richard Zhang.
   9          -*------------------------------------------------------------------*/
  10          
  11          #include "Main.h"
  12          #include "Port.h"
  13          
  14          #include "Selflearn.h"
  15          #include "Speech.h"
  16          #include "ISP_DataFlash.h"
  17          #include "UART.h"
  18          #include "Receiver.h"
  19          
  20          // ------ Public variable definitions ------------------------------
  21          tByte Passwd_reed_switch_time;
  22          // ------ Public variable declarations -----------------------------
  23          extern bit Received_finished_G;
  24          extern tByte Received_cache[7];
  25          
  26          extern bit hSCH_sleep_EN;
  27          extern bit Passwd_reed_switch_port;
  28          
  29          // ------ Private variables ----------------------------------------
  30          
  31          // ------ Private constants ----------------------------------------
  32          
  33          /*------------------------------------------------------------------*-
  34            Selflearn_Init()
  35            Initialisation function for the switch library.
  36          -*------------------------------------------------------------------*/
  37          void Selflearn_Init(void)
  38             {
  39   1         // Set P0.3(Passwd_reed_switch_port) to input mode.
  40   1      // P2M1 |= 0x20;
  41   1      // P2M2 &= 0xdf;
  42   1         
  43   1         Passwd_reed_switch_time = 0;
  44   1         }
  45          
  46          
  47          /*------------------------------------------------------------------*-
  48            Self_learn_action()
  49            Initialisation function for the switch library.
  50          -*------------------------------------------------------------------*/
  51          void Self_learn_action(void)
  52             {
  53   1         if(!Passwd_reed_switch_port)
  54   1            RXD_power_on();
C51 COMPILER V9.54   SELFLEARN                                                             06/16/2016 11:58:37 PAGE 2   

  55   1      
  56   1         if((!Passwd_reed_switch_port)&&(Received_finished_G))
  57   1            {
  58   2            Goto_speech(Ticktack);
  59   2            Self_learn_programming();
  60   2            Received_finished_G = 0;
  61   2            
  62   2            // Close passwd matching.
  63   2            Passwd_reed_switch_port = 1;
  64   2            }
  65   1         }
  66          
  67          /*------------------------------------------------------------------*-
  68            Self_learn_reset()
  69            Initialisation function for the switch library.
  70          -*------------------------------------------------------------------*/
  71          void Self_learn_reset(void)
  72             {
  73   1         if(!Passwd_reed_switch_port)
  74   1            {
  75   2            Passwd_reed_switch_time += 1;
  76   2            if(Passwd_reed_switch_time > 10)
  77   2               {
  78   3               Passwd_reed_switch_time = 0;
  79   3               Passwd_reed_switch_port = 1;
  80   3               }
  81   2            }
  82   1         }
  83          
  84          /*------------------------------------------------------------------*-
  85            Self_learn_programming()
  86            Initialisation function for the switch library.
  87          -*------------------------------------------------------------------*/
  88          void Self_learn_programming(void)
  89             {
  90   1         Flash_Page_Erase(0x3000);
  91   1         Flash_Write_Data(0x3000, Received_cache[5]);
  92   1         Flash_Write_Data(0x3001, Received_cache[4]);
  93   1         Flash_Write_Data(0x3002, Received_cache[3]);
  94   1         Flash_Write_Data(0x3003, Received_cache[2]);
  95   1         Flash_Write_Data(0x3004, Received_cache[1]);
  96   1         Flash_Write_Data(0x3005, Received_cache[0]);
  97   1         }
  98          
  99          /*------------------------------------------------------------------*-
 100            ---- END OF FILE -------------------------------------------------
 101          -*------------------------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    108    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
