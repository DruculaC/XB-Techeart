C51 COMPILER V9.54   BUTTON                                                                04/22/2016 14:54:23 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE BUTTON
OBJECT MODULE PLACED IN .\Objects\Button.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE Button.c ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG
                    - OBJECTEXTEND PRINT(.\Listings\Button.lst) TABS(3) OBJECT(.\Objects\Button.obj)

line level    source

   1          /*------------------------------------------------------------------*-
   2             Button.c (v1.00)
   3            ------------------------------------------------------------------
   4             Motor key button detecting for motor vehicle.
   5          
   6             COPYRIGHT
   7             ---------
   8             This code is copyright (c) 2016 by Richard Zhang.
   9          -*------------------------------------------------------------------*/
  10          
  11          #include "Main.h"
  12          #include "Port.h"
  13          
  14          #include "Button.h"
  15          #include "Selflearn.h"
  16          #include "Speech.h"
  17          
  18          // ------ Public variable definitions ------------------------------
  19          extern bit Alarm_G;
  20          
  21          // ------ Public variable declarations -----------------------------
  22          bit System_EN_G;     // Flag for system enabled, 0 for not enabled, 1 for enabled.
  23          bit XB_open_flag;
  24          // ------ Private variables ----------------------------------------
  25          tByte XB_reed_HVtime;
  26          tByte XB_reed_level;
  27          
  28          // ------ Private constants ----------------------------------------
  29          
  30          
  31          /*------------------------------------------------------------------*-
  32            Button_Init()
  33            Initialisation function for the switch library.
  34          -*------------------------------------------------------------------*/
  35          void Button_Init(void)
  36             {
  37   1         // Set P0.4(XB_reed_switch_port) to input mode.
  38   1         P0M1 |= 0x02;
  39   1         P0M2 &= 0xfd;
  40   1         
  41   1         XB_reed_HVtime = 0;
  42   1         XB_reed_level = 0;
  43   1         System_EN_G = 0;
  44   1         XB_open_flag = 0;
  45   1         }
  46          
  47          /*------------------------------------------------------------------*-
  48             Button_update()
  49             Update motor's key button, 1 for open, 0 for close, 100ms/ticket
  50          -*------------------------------------------------------------------*/
  51          void Button_update(void)
  52             {
  53   1         XB_reed_detection();
  54   1         
C51 COMPILER V9.54   BUTTON                                                                04/22/2016 14:54:23 PAGE 2   

  55   1         Self_learn_action();
  56   1         }
  57          
  58          /*------------------------------------------------------------------*-
  59             XB_reed_detection()
  60          -*------------------------------------------------------------------*/
  61          void XB_reed_detection(void)
  62             {
  63   1         if((System_EN_G)&&(XB_reed_switch_port)&&(XB_open_flag == 0))
  64   1            {
  65   2            Alarm_G = 1;
  66   2            }
  67   1         else if(!XB_reed_switch_port)
  68   1            {
  69   2            XB_open_flag = 0;
  70   2            }
  71   1         }
  72          
  73          /*------------------------------------------------------------------*-
  74            ---- END OF FILE -------------------------------------------------
  75          -*------------------------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     40    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
