C51 COMPILER V9.54   BUTTON                                                                06/16/2016 11:58:36 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE BUTTON
OBJECT MODULE PLACED IN .\Objects\Button.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE Button.c ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG
                    - OBJECTEXTEND PRINT(.\Listings\Button.lst) TABS(3) OBJECT(.\Objects\Button.obj)

line level    source

   1          /*------------------------------------------------------------------*-
   2             Button.c (v1.00)
   3            ------------------------------------------------------------------
   4             Motor key button detecting for motor vehicle.
   5          
   6             COPYRIGHT
   7             ---------
   8             This code is copyright (c) 2016 by Richard Zhang.
   9          -*------------------------------------------------------------------*/
  10          
  11          #include "Main.h"
  12          #include "Port.h"
  13          
  14          #include "Button.h"
  15          #include "Selflearn.h"
  16          #include "Speech.h"
  17          
  18          // ------ Public variable definitions ------------------------------
  19          extern bit Alarm_G;
  20          
  21          // ------ Public variable declarations -----------------------------
  22          bit System_EN_G;     // Flag for system enabled, 0 for not enabled, 1 for enabled.
  23          bit XB_open_flag;
  24          bit Passwd_reed_switch_port;  // Passwd match.
  25                                        // 0 for open passwd matching, 1 for shut down matching.
  26          // ------ Private variables ----------------------------------------
  27          tByte XB_reed_HVtime;
  28          tByte XB_reed_level;
  29          
  30          // ------ Private constants ----------------------------------------
  31          
  32          
  33          /*------------------------------------------------------------------*-
  34            Button_Init()
  35            Initialisation function for the switch library.
  36          -*------------------------------------------------------------------*/
  37          void Button_Init(void)
  38             {
  39   1         // Set P0.1(XB_reed_switch_port) to input mode.
  40   1      // P0M1 |= 0x02;
  41   1      // P0M2 &= 0xfd;
  42   1         
  43   1         XB_reed_HVtime = 0;
  44   1         XB_reed_level = 0;
  45   1         System_EN_G = 0;
  46   1         XB_open_flag = 0;
  47   1         Passwd_reed_switch_port = 0;
  48   1         }
  49          
  50          /*------------------------------------------------------------------*-
  51             Button_update()
  52             Update motor's key button, 1 for open, 0 for close, 100ms/ticket
  53          -*------------------------------------------------------------------*/
  54          void Button_update(void)
C51 COMPILER V9.54   BUTTON                                                                06/16/2016 11:58:36 PAGE 2   

  55             {
  56   1      // XB_reed_detection();
  57   1         Self_learn_action();
  58   1         }
  59          
  60          /*------------------------------------------------------------------*-
  61             XB_reed_detection()
  62          -*------------------------------------------------------------------*/
  63          void XB_reed_detection(void)
  64             {
  65   1         if((System_EN_G)&&(XB_reed_switch_port)&&(XB_open_flag == 0))
  66   1            {
  67   2            Alarm_G = 1;
  68   2            }
  69   1         else if(!XB_reed_switch_port)
  70   1            {
  71   2            XB_open_flag = 0;
  72   2            }
  73   1         }
  74          
  75          /*------------------------------------------------------------------*-
  76            ---- END OF FILE -------------------------------------------------
  77          -*------------------------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     33    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
