C51 COMPILER V9.54   BUTTON                                                                04/01/2016 10:06:43 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE BUTTON
OBJECT MODULE PLACED IN .\Objects\Button.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_v5\C51\BIN\C51.EXE Button.c ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG
                    - OBJECTEXTEND PRINT(.\Listings\Button.lst) TABS(3) OBJECT(.\Objects\Button.obj)

line level    source

   1          /*------------------------------------------------------------------*-
   2             Button.c (v1.00)
   3            ------------------------------------------------------------------
   4             Motor key button detecting for motor vehicle.
   5          
   6             COPYRIGHT
   7             ---------
   8             This code is copyright (c) 2016 by Richard Zhang.
   9          -*------------------------------------------------------------------*/
  10          
  11          #include "Main.h"
  12          #include "Port.h"
  13          
  14          #include "Button.h"
  15          #include "Selflearn.h"
  16          #include "Speech.h"
  17          
  18          // ------ Public variable definitions ------------------------------
  19          bit System_EN_G;     // Flag for system enabled, 0 for not enabled, 1 for enabled.
  20          
  21          // ------ Public variable declarations -----------------------------
  22          extern bit ID_certificated_G;
  23          
  24          // ------ Private variables ----------------------------------------
  25          tByte XB_reed_HVtime;
  26          tByte XB_reed_level;
  27          
  28          // ------ Private constants ----------------------------------------
  29          
  30          
  31          /*------------------------------------------------------------------*-
  32            Button_Init()
  33            Initialisation function for the switch library.
  34          -*------------------------------------------------------------------*/
  35          void Button_Init(void)
  36             {
  37   1         // Set P0.4(XB_reed_switch_port) to input mode.
  38   1         P0M1 |= 0x02;
  39   1         P0M2 &= 0xfd;
  40   1         
  41   1         XB_reed_HVtime = 0;
  42   1         XB_reed_level = 0;
  43   1         System_EN_G = 0;
  44   1         }
  45          
  46          /*------------------------------------------------------------------*-
  47             Button_update()
  48             Update motor's key button, 1 for open, 0 for close, 50ms/ticket
  49          -*------------------------------------------------------------------*/
  50          void Button_update(void)
  51             {  
  52   1         XB_reed_detection();
  53   1         
  54   1         Self_learn_action();
C51 COMPILER V9.54   BUTTON                                                                04/01/2016 10:06:43 PAGE 2   

  55   1         
  56   1         // Instant broadcast "tick" voice
  57   1         Speech_s_update();
  58   1         }
  59          
  60          /*------------------------------------------------------------------*-
  61             XB_reed_detection()
  62          -*------------------------------------------------------------------*/
  63          void XB_reed_detection(void)
  64             {
  65   1         if(XB_reed_switch_port)
  66   1            {
  67   2            XB_reed_HVtime += 1;
  68   2            // If exceed 3s, then reset.
  69   2            if(XB_reed_HVtime > 60)
  70   2               {
  71   3               XB_reed_HVtime = 0;
  72   3               XB_reed_level = 0;
  73   3               }
  74   2            }
  75   1         else
  76   1            {
  77   2            if(XB_reed_HVtime >= 4)
  78   2               {
  79   3               XB_reed_HVtime = 0;
  80   3               XB_reed_level += 1;
  81   3               }
  82   2            }
  83   1      
  84   1         // If open and close for 3 times, triggle.
  85   1         if(XB_reed_level >= 3)
  86   1            {
  87   2            XB_reed_level = 0;
  88   2            System_EN_G = ~System_EN_G;
  89   2            // If system is enabled, deploy the vibration sensor and ultrasonic sensor.
  90   2            if(System_EN_G == 1)
  91   2               Goto_speech(System_open);
  92   2            else
  93   2               Goto_speech(System_closed);
  94   2            }  
  95   1         }
  96          
  97          /*------------------------------------------------------------------*-
  98            ---- END OF FILE -------------------------------------------------
  99          -*------------------------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     79    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
